---
title: "V5 - FINAL"
output: word_document
---

# Party platforms
```{r}
# Preparation 
library(tidyverse)
setwd("~/Library/Mobile Documents/com~apple~CloudDocs/PhD/GA with Dr. Suhay") # Mac
# setwd("C:/Users/Mark's computer/iCloudDrive/PhD/GA with Dr. Suhay") # PC

data <- read.csv('manuscript_fig1.csv')
names(data)[1] <- 'Year'

# Averages for each platform (cited in text)
test <- data %>% 
  summarise(sum = Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq,
            pct = mean(sum))

range(test$sum)

# of attributions for all years
data %>% 
  mutate(sum = Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq) %>% 
  select(Year, Party, sum) %>% 
  ggplot(., aes(x = Year, fill = Party, y = sum)) + 
  geom_col(position = 'dodge', color = 'black') + 
  theme_bw() +
  scale_x_continuous(breaks = seq(1980, 2020, 4)) +
  theme(panel.grid = element_blank()) +
  labs(title = 'Inequality Code Sum', y = '', x = '') + 
  scale_fill_manual(values = c('gray40', 'gray70'))


ggsave('platformfreqs.png', height = 6, width = 10)

# prep
data1 <- data %>% 
  group_by(Year, Party) %>% 
  dplyr::summarize(char = Characteristics_freq / (Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq),
                   eff = Effort_freq / (Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq),
                   cul = Culture_freq / (Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq),
                   disc = Discrimination_freq / (Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq),
                   exc = Excess_freq / (Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq),
                   opp = Opportunity_freq / (Characteristics_freq + Effort_freq + Culture_freq + Discrimination_freq + Excess_freq + Opportunity_freq)) %>% 
  mutate(Party = case_when(Party == 'Democratic' ~ 'Democratic Platform',
                           Party == 'Republican' ~ 'Republican Platform'))

ind <- data1 %>% 
  dplyr::select(Year, Party, char, eff, cul)

soc <- data1 %>% 
  dplyr::select(Year, Party, disc, exc, opp)

# Individual
colors_ind <- c('char' = 'black',
                'cul' = 'gray40',
                'eff' = 'gray70')

ind_plot <- ind %>% 
  ggplot(., aes(x = Year)) + 
  geom_line(aes(y = char, color = 'char')) + 
  geom_point(aes(y = char, color = 'char')) + 
  geom_line(aes(y = eff, color = 'eff')) + 
  geom_point(aes(y = eff, color = 'eff')) + 
  geom_line(aes(y = cul, color = 'cul')) + 
  geom_point(aes(y = cul, color = 'cul')) + 
  facet_wrap(~ Party) + 
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(angle = 90, vjust=0.5, hjust=1)) + 
  scale_color_manual(values = colors_ind,
                     labels = c('Character and Ability', 'Culture and Family', 'Effort')) + 
  labs(title = 'Individual / Group Attributions', y = '', x = '', color = 'Attribution Type') + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),
                     limits = c(0, 1),
                     breaks = seq(0, 1, .1)) +
  scale_x_continuous(breaks = seq(1980, 2020, 4))

# structural
colors_struc <- c('opp' = 'black',
                  'disc' = 'gray40',
                  'exc' = 'gray70')

soc_plot <- soc %>% 
  ggplot(., aes(x = Year)) + 
  geom_line(aes(y = opp, color = 'opp')) + 
  geom_point(aes(y = opp, color = 'opp')) + 
  geom_line(aes(y = disc, color = 'disc')) + 
  geom_point(aes(y = disc, color = 'disc')) + 
  geom_line(aes(y = exc, color = 'exc')) + 
  geom_point(aes(y = exc, color = 'exc')) + 
  facet_wrap(~ Party) + 
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(angle = 90, vjust=0.5, hjust=1)) + 
  scale_color_manual(values = colors_struc,
                     labels = c('Access to Opportunity',
                                'Discrimination',
                                'Excess Government')) + 
  labs(title = 'Societal / Institutional Attributions', x = '', color = 'Attribution Type', y = '') + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),
                     limits = c(0, 1),
                     breaks = seq(0, 1, .1)) +
  scale_x_continuous(breaks = seq(1980, 2020, 4))

# Together
cowplot::plot_grid(ind_plot, soc_plot, ncol = 1)

ggsave('forum_parties.png', height = 6, width = 8)
```


# Regressions
## ANES
### 1.1 Preparation
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(survey)
library(jtools)
library(interactions)
library(haven)
setwd("C:/Users/Mark's computer/iCloudDrive/Research/The Forum Article") # PC
#setwd("~/Library/Mobile Documents/com~apple~CloudDocs/Research/The Forum Article") # MAc
anes12 <- read_dta('anes2012_restric.dta')

# Prep
anes12 <- anes12 %>% 
  filter(DEM_EDUGROUP_X > 0, # ditching NAs/IDKs in controls
         DEM_RACEETH_X > 0, 
         PID_X > 0,
         EGAL_BIGPROB > 0,
         INCGROUP_PREPOST_X > 0,
         DEM_AGE_R_X > 0) %>% 
  mutate(Male = ifelse(GENDER_RESPONDENT_X == 1, 1, 0),
         Age = (DEM_AGE_R_X - 17)/73,
         Inc = (INCGROUP_PREPOST_X-1)/27,                           
         Educ = (DEM_EDUGROUP_X-1)/4,                              # 5 pt
         White = ifelse(DEM_RACEETH_X == 1, 1, 0),           # nonhisp white
         GOP = (PID_X-1)/6,
         Equal_Chance = case_when(EGAL_BIGPROB == 1 ~ 4,     # reverse
                                  EGAL_BIGPROB == 2 ~ 3,
                                  EGAL_BIGPROB == 3 ~ 2,
                                  EGAL_BIGPROB == 4 ~ 1,
                                  EGAL_BIGPROB == 5 ~ 0),
         Equal_Chance = Equal_Chance/4,
         Gov_Job = case_when(GUARPR_SELF == 1 ~ 6, 
                             GUARPR_SELF == 2 ~ 5,
                             GUARPR_SELF == 3 ~ 4, 
                             GUARPR_SELF == 4 ~ 3,
                             GUARPR_SELF == 5 ~ 2, 
                             GUARPR_SELF == 6 ~ 1,
                             GUARPR_SELF == 7 ~ 0),
         Gov_Job = Gov_Job/6,                          # reverse, 0-1
         Gov_Insure = case_when(INSPRE_SELF == 1 ~ 6, 
                                INSPRE_SELF == 2 ~ 5,
                                INSPRE_SELF == 3 ~ 4, 
                                INSPRE_SELF == 4 ~ 3,
                                INSPRE_SELF == 5 ~ 2,
                                INSPRE_SELF == 6 ~ 1,
                                INSPRE_SELF == 7 ~ 0),
         Gov_Insure = Gov_Insure/6,                       # reverse, 0-1
         Educ_Spend = case_when(CSES_EXPEDUC == 1 ~ 4, 
                                CSES_EXPEDUC == 2 ~ 3,
                                CSES_EXPEDUC == 3 ~ 2,
                                CSES_EXPEDUC == 4 ~ 1,
                                CSES_EXPEDUC == 5 ~ 0),
         Educ_Spend = Educ_Spend/4,                       # reverse, 0-1
         UI_Spend = case_when(CSES_EXPUNEMP == 1 ~ 4,
                              CSES_EXPUNEMP == 2 ~ 3,
                              CSES_EXPUNEMP == 3 ~ 2,
                              CSES_EXPUNEMP == 4 ~ 1,
                              CSES_EXPUNEMP == 5 ~ 0),
         UI_Spend = UI_Spend/4,
         Ineq_Measures = case_when(CSES_GOVTACT == 1 ~ 4,
                                   CSES_GOVTACT == 2 ~ 3,
                                   CSES_GOVTACT == 3 ~ 2,
                                   CSES_GOVTACT == 4 ~ 1,
                                   CSES_GOVTACT == 5 ~ 0),
         Ineq_Measures = Ineq_Measures/4,
         Poor_Spend = case_when(FEDSPEND_POOR == 1 ~ 2,
                                FEDSPEND_POOR == 3 ~ 1, # re-ordering 
                                FEDSPEND_POOR == 2 ~ 0),
         Poor_Spend = Poor_Spend/2,                     # 0-1
         Affirm_Work = case_when(AA_WORK_X == 1 ~ 6,
                                 AA_WORK_X == 2 ~ 5,
                                 AA_WORK_X == 3 ~ 4,
                                 AA_WORK_X == 4 ~ 3,
                                 AA_WORK_X == 5 ~ 2,
                                 AA_WORK_X == 6 ~ 1,
                                 AA_WORK_X == 7 ~ 0),
         Affirm_Work = Affirm_Work/6,                 # reverse, 0-1
         Obama = case_when(PRESVOTE2012_X == 1 ~ 1,   # two-party vote share
                           PRESVOTE2012_X == 2 ~ 0)) 

# Cronbach's alpha test
alpha.test <- svydesign(id = ~CASEID, nest=TRUE, survey.lonely.psu = "adjust", 
                        weights = ~WEIGHT_FULL, data = anes12)

svycralpha(~Educ_Spend + UI_Spend + Poor_Spend, alpha.test, na.rm = T) # gov spending
svycralpha(~Gov_Job + Gov_Insure, alpha.test, na.rm = T) # Gov jobs and healthcare



# building index
anes12 <- anes12 %>% 
  mutate(Gov_spend_index = (Educ_Spend + UI_Spend + Poor_Spend)/3,
         Gov_jh_index = (Gov_Job + Gov_Insure)/2)
```

### 1.2 Tables
```{r message=FALSE, warning=FALSE}
# Gov spending
anes_govspend <- lm(Gov_spend_index ~ Equal_Chance + GOP + Educ + Inc + Age + Male + White, data = anes12, weights = WEIGHT_FULL)

# Gov jobs and healthcare
anes_jobhc <- lm(Gov_jh_index ~ Equal_Chance + GOP + Educ + Inc + Age + Male + White, data = anes12, weights = WEIGHT_FULL)

# Gov reduce inequality
anes_ineq <- lm(Ineq_Measures ~ Equal_Chance + GOP + Educ + Inc + Age + Male + White, data = anes12, weights = WEIGHT_FULL)

# Affirmative Action
anes_affirm <- lm(Affirm_Work ~ Equal_Chance + GOP + Educ + Inc + Age + Male + White, data = anes12, weights = WEIGHT_FULL)

# 2012 vote choice
anes_vote <-lm(Obama ~ Equal_Chance + GOP + Educ + Inc + Age + Male + White, data = anes12, weights = WEIGHT_FULL)

# Table
stargazer::stargazer(anes_govspend, anes_jobhc, anes_ineq, anes_affirm, anes_vote, 
                     type = 'html', title = '',
                     column.labels = c('Gov Spending', 'Gov Jobs/Health', 'Gov Reduce Ineq', 'Affirmative Action', 'Dem Vote'),
                     dep.var.labels.include = F,
                     out = 'anes_reg.html', notes.align = 'l', notes.append = F,
                     dep.var.caption = 'Outcome Variable:',
                     omit.stat = 'f', 
                     covariate.labels = c('Disagree Equal Chance', 'Party (Republican)', 'Education', 'Income', 'Age', 
                                                             'Male', 'White', 'Constant'),
                     notes = 'ANES 2012. *p<0.1; **p<0.05; ***p<0.01')
```



### 2 GSS


#### 2.1 Preparation

*attributions* (1) racial differences index, and (2)‘Some people say that people get ahead by their own hard work; others say that lucky breaks or help from other people are more important. Which do you think is most important?’ 


```{r message=FALSE, warning=FALSE}
gss <- read_dta('gsscumulative.dta')

gss1 <- gss %>% 
  filter(degree >= 0, income != 13) %>% 
  mutate(Male = ifelse(sex == 1, 1, 0),
         Age = (age-18)/71,
         GOP = case_when(partyid == 1 ~ 0, partyid == 2 ~ 1, 
                         partyid == 3 ~ 2, partyid == 4 ~ 3,
                         partyid == 5 ~ 4, partyid == 6 ~ 5,
                         partyid == 7 ~ 6),
         GOP = GOP/6,
         Inc = (income-1)/11,                       # 12 pt (only up to $25K)
         Educ = degree/4,                      # 5 pt
         White = ifelse(race == 1, 1, 0),    # all self-ID
           rd1 = case_when(racdif1 == 1 ~ 1, 
                           racdif1 == 2 ~ 0), # discrimination
           rd3 = case_when(racdif3 == 1 ~ 1, 
                           racdif3 == 2 ~ 0), # lack of education
           rd4 = case_when(racdif4 == 2 ~ 1, 
                           racdif4 == 1 ~ 0), # lack of will (reverse)
         Race_Dif = rd1 + rd3 + rd4,
         Race_Dif = Race_Dif/3,
         Hard_Work = case_when(getahead == 1 ~ 0, 
                               getahead == 2 ~ 1,
                               getahead == 3 ~ 2),
         Hard_Work = Hard_Work/2,
           hp = case_when(helppoor == 1 ~ 4,
                          helppoor == 2 ~ 3,
                          helppoor == 3 ~ 2,
                          helppoor == 4 ~ 1,
                          helppoor == 5 ~ 0),
         Help_Poor = hp/4,                   # reverse, 0-1
           hs = case_when(helpsick == 1 ~ 4,
                          helpsick == 2 ~ 3,
                          helpsick == 3 ~ 2,
                          helpsick == 4 ~ 1,
                          helpsick == 5 ~ 0),
         Help_Sick = hs/4,                   # reverse, 0-1
          se = case_when(nateduc == 1 ~ 2, 
                         nateduc == 2 ~ 1,
                         nateduc == 3 ~ 0),
         Spend_Educ = se/2,                  # reverse, 0-1
          he = case_when(govunemp == 1 ~ 4, 
                         govunemp == 2 ~ 3,
                         govunemp == 3 ~ 2,
                         govunemp == 4 ~ 1,
                         govunemp == 5 ~ 0),
         Help_UI = he/4,                     # reverse, 0-1
          hi = case_when(goveqinc == 1 ~ 4,
                         goveqinc == 2 ~ 3,
                         goveqinc == 3 ~ 2,
                         goveqinc == 4 ~ 1,
                         goveqinc == 5 ~ 0),
         Gov_Ineq = hi/4,                    # reverse, 0-1
          aw = case_when(affrmact == 1 ~ 3,
                         affrmact == 2 ~ 2,
                         affrmact == 3 ~ 1,
                         affrmact == 4 ~ 0),
         Affirm_Work = aw/3,                 # reverse, 0-1
         Clinton = case_when(pres16 == 1 ~ 1,# two-party vote
                             pres16 == 2 ~ 0),
         Welfare = (Help_Poor + Help_Sick + Spend_Educ + Gov_Ineq)/4)

#gss21 <- gss1 %>% filter(year == 2021)
gss18 <- gss1 %>% filter(year == 2018)

# Cronbach's alpha test
alpha.test <- svydesign(id = ~id, nest=TRUE, survey.lonely.psu = "adjust", 
                        weights = ~wtssall, data = gss18)

svycralpha(~Help_Poor + Help_Sick + Spend_Educ  + Gov_Ineq,  alpha.test, na.rm = T)

svycralpha(~rd1 + rd3  + rd4,  alpha.test, na.rm = T)


```

### 2.2 Models
```{r}
# Four gov welfare questions - Racial differences
diff_poor <- lm(Help_Poor ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
diff_sick <- lm(Help_Sick ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
diff_educ <- lm(Spend_Educ ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
diff_ineq <- lm(Gov_Ineq ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
affirm_diff <- lm(Affirm_Work ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
vote_diff <- lm(Clinton ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)

stargazer::stargazer(diff_poor, diff_sick, diff_educ, diff_ineq, affirm_diff, vote_diff, type = 'html', title = '', 
                     dep.var.caption = 'Outcome Variable:', out = 'gss_reg_gov_race.html',
                     column.labels = c('Gov Help Poor', 'Gov Health', 'Spending on Educ', 'Gov Reduce Ineq', 'Affirmative Action', 'Dem Vote'),
                     dep.var.labels.include = F, omit.stat = 'f', 
                     covariate.labels = c('Racial Differences', 'Party (Republican)', 'Education', 'Income', 'Age', 'Male', 'White', 'Constant'),
                     notes = 'GSS 2018. *p<0.1; **p<0.05; ***p<0.01', notes.align = 'l', notes.append = F)

# four gov welfare questions - hard work
work_poor <- lm(Help_Poor ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
work_sick <- lm(Help_Sick ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
work_educ <- lm(Spend_Educ ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
work_ineq <- lm(Gov_Ineq ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)

stargazer::stargazer(work_poor, work_sick, work_educ, work_ineq, type = 'html', title = '', 
                     dep.var.caption = 'Government Welfare Questions - Luck (vs Hard Work)', out = 'gss_reg_gov_work.html',
                     column.labels = c('Gov Help Poor', 'Gov Pay Health', 'Spending on Educ', 'Gov reduce ineq'),
                     dep.var.labels.include = F, omit.stat = 'f',
                     covariate.labels = c('Luck (vs hard work)', 'Party', 'Education', 'Income', 'Age', 'Male', 'White', 'Constant'))

```



```{r}
# Vote 2016
vote_diff <- lm(Clinton ~ Race_Dif + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
vote_work <- lm(Clinton ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
vote_both <- lm(Clinton ~ Race_Dif + Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)

stargazer::stargazer(vote_diff, vote_work, vote_both, type = 'html', title = 'GSS data (2018)', 
                     dep.var.caption = 'Support for Clinton (vs Trump)', out = 'gss_reg_vote.html', omit.stat = 'f',
                     covariate.labels = c('Racial Differences', 'Luck (vs hard work)', 'Party', 'Education', 'Income', 
                                          'Age', 'Male', 'White', 'Constant'))

# Affirmative action at work
affirm_diff <- lm(Affirm_Work ~ Race_Dif +Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
affirm_work <- lm(Affirm_Work ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)
affirm_both <- lm(Affirm_Work ~ Race_Dif + Hard_Work + GOP + Educ + Inc + Age + Male + White, data = gss18, weights = wtssall)

stargazer::stargazer(affirm_diff, affirm_work, affirm_both, type = 'html', title = 'GSS data (2018)', 
                     dep.var.caption = 'Support for Affirmative Action in the Workplace', out = 'gss_reg_race.html', omit.stat = 'f',
                     covariate.labels = c('Racial Differences', 'Luck (vs hard work)', 'Party', 'Education', 'Income', 
                                          'Age', 'Male', 'White', 'Constant'))

```

## 3 Pew second attribution
The attribution here is: "most people who want to get ahead can make it if they work hard" (vs hard work is no guarantee of success for most people)
### 3.1 Preparation
```{r}
pew53 <- read_sav('pew53.sav')
pew53$F_AGECAT[pew53$F_AGECAT == 99] <- NA
pew53$F_EDUCCAT2[pew53$F_EDUCCAT2 == 99] <- NA
pew53$F_INCOME[pew53$F_INCOME == 99] <- NA

pew53 <- pew53 %>% 
  mutate(Male = ifelse(F_SEX == 1, 1, 0),
         Age = (F_AGECAT-1)/3,
         White = ifelse(F_RACETHN == 1, 1, 0),
         Educ = (F_EDUCCAT2-1)/5,
         Inc = (F_INCOME-1)/8,
         GOP = case_when(F_PARTY_FINAL == 2 ~ 0,
                         F_PARTY_FINAL == 3 ~ 1,
                         F_PARTY_FINAL == 1 ~ 2), 
         GOP = GOP/2,
        Hard_Work = case_when(WORKHARD_W53 == 1 ~ 0, # just 2 statements
                              WORKHARD_W53 == 2 ~ 1),
        Gov_Needy = case_when(GOVNEEDY_W53 == 1 ~ 1, 
                              GOVNEEDY_W53 == 2 ~ 0),
        Poor_Assist = case_when(POORASSIST_W53 == 2 ~ 0,
                                POORASSIST_W53 == 3 ~ 1, # reordering
                                POORASSIST_W53 == 1 ~ 2),
        Poor_Assist/2,
        Inc_Tax_Raise = case_when(TAXRATES250_W53 == 1 ~ 4,
                                  TAXRATES250_W53 == 2 ~ 3,
                                  TAXRATES250_W53 == 5 ~ 2, # reordering
                                  TAXRATES250_W53 == 3 ~ 1, # reverse
                                  TAXRATES250_W53 == 4 ~ 0),
        Inc_Tax_Raise = Inc_Tax_Raise/4,
        Corp_Tax_Raise = case_when(TAXRATESBUS_W53 == 1 ~ 4,
                                  TAXRATESBUS_W53 == 2 ~ 3,
                                  TAXRATESBUS_W53 == 5 ~ 2, # reordering
                                  TAXRATESBUS_W53 == 3 ~ 1, # reverse
                                  TAXRATESBUS_W53 == 4 ~ 0),
        Corp_Tax_Raise = Corp_Tax_Raise/4,
        Gov_Health = case_when(GOVTHC_W53 == 1 & SNGLPYER_W53 == 1 ~ 3,
                               GOVTHC_W53 == 1 & SNGLPYER_W53 == 2 ~ 2,
                               GOVTHC_W53 == 2 & NOGOVTHC_W53 == 2 ~ 1,
                               GOVTHC_W53 == 1 & NOGOVTHC_W53 == 1 ~ 0),
        Gov_Health = Gov_Health/3,
        Democrat = case_when(TRUMPDEM2020_W53 == 3 | 
                             TRUMPDEM2020_W53 == 4 ~ 1,
                             TRUMPDEM2020_W53 == 1 |
                             TRUMPDEM2020_W53 == 2 ~ 0))

```


### 3.2 Models
```{r message=FALSE, warning=FALSE, include=FALSE}

p2_gov_needy <- lm(Gov_Needy ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, weights = WEIGHT_W53, data = pew53)

p2_poor_assist <- lm(Poor_Assist ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, weights = WEIGHT_W53, data = pew53)

p2_inc_tax <- lm(Inc_Tax_Raise ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, weights = WEIGHT_W53, data = pew53)

p2_corp_tax <- lm(Corp_Tax_Raise ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, weights = WEIGHT_W53, data = pew53)

p2_gov_health <- lm(Gov_Health ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, weights = WEIGHT_W53, data = pew53)

p2_dem <- lm(Democrat ~ Hard_Work + GOP + Educ + Inc + Age + Male + White, weights = WEIGHT_W53, data = pew53)

stargazer::stargazer(type = 'html', p2_gov_needy, p2_poor_assist, p2_inc_tax, p2_corp_tax, p2_gov_health, p2_dem, column.labels = 
c('Gov Help if Debt', 'Gov Help Needy', 'Rich Pay More', 'Corps Pay More', 'Gov Health', 'Dem Vote'),
dep.var.labels.include = F, title = '', dep.var.caption = 'Outcome Variable:', out = 'pew2_reg.html', omit.stat = 'f',
covariate.labels = c('Hard work no guarantee', 'Party (Republican)', 'Education', 'Income', 'Age', 'Male', 'White', 'Constant'),
notes = 'Pew American Trends 53 (2019). *p<0.1; **p<0.05; ***p<0.01', notes.align = 'l', notes.append = F)


```










































# Over time
## Libraries and directories
```{r echo=FALSE, message=FALSE, warning=FALSE}
## Libraries
library(haven)
library(Hmisc)
library(tidyverse)

## Directories
setwd("C:/Users/Mark's computer/iCloudDrive/Research/The Forum Article") # PC 
```

## Data prep
```{r echo=FALSE, message=FALSE, warning=FALSE}
## Cumulative datas
anes_all <- read.csv('anes_all.csv')
anes_all <- anes_all %>%
  mutate(Party = case_when(VCF0301 >0 & VCF0301 < 4 ~ 'Democrat',
                           VCF0301 > 4 ~ 'Republican'))

## ANES 2020
anes20 <- read.csv('anes20.csv')
anes20 <- anes20 %>% 
  mutate(Party = case_when(V201231x < 4 & V201231x > 0 ~ 'Democrat',
                           V201231x > 4 ~ 'Republican'))
         
## ANES 2002
anes02 <- read_dta('anes02.dta')
anes02 <- anes02 %>%
  mutate(Party = case_when(V023038x < 3 ~ 'Democrat',
                           V023038x > 3 & V023038x < 7 ~ 'Republican'))

# ANES 1972
anes72 <- read_dta('anes72.dta')
anes72 <- anes72 %>% 
  mutate(Party = case_when(V720140 < 3 ~ 'Democrat', 
                           V720140 > 3 & V720140 < 7 ~ 'Republican'))

# ANES 1976
anes76 <- read_dta('anes76.dta')
anes76 <- anes76 %>% 
  mutate(Party = case_when(V763174 < 3 ~ 'Democrat', 
                           V763174 > 3 & V763174 < 7 ~ 'Republican'))

# Pew 2019 American trends 54
pew19 <- read_sav('pew19.sav')
pew19 <- pew19 %>%      # See page 34 of top-line PDF of wave 54 for PID coding
  mutate(Party = case_when(F_PARTYSUM_FINAL == 1 ~ 'Republican',
                           F_PARTYSUM_FINAL == 2 ~ 'Democrat')) 

# Pew 2018 Political survey
pew18 <- read_sav('pew18.sav')
pew18 <- pew18 %>% 
  mutate(Party = case_when(partysum == 1 ~ 'Republican',
                           partysum == 2 ~ 'Democrat'))

# Pew 2017 Political survey
pew17 <- read_sav('pew17.sav')
pew17 <- pew17 %>% 
  mutate(Party = case_when(partysum == 1 ~ 'Republican',
                           partysum == 2 ~ 'Democrat'))

# Pew 2016 Political survey
pew16 <- read_sav('pew16.sav')
pew16 <- pew16 %>% 
  mutate(Party = case_when(partysum == 1 ~ 'Republican',
                           partysum == 2 ~ 'Democrat'))

# Pew 2015 Political survey
pew15 <- read_sav('pew15.sav')
pew15 <- pew15 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

# Pew 2014 Polarization survey
pew14 <- read_sav('pew14.sav')
pew14 <- pew14 %>% 
  mutate(Party = (case_when(partysum == 1 ~ 'Republican',
                            partysum == 2 ~ 'Democrat')))

# Pew 2012 middle class survey
pew12 <- read_sav('pew12.sav')
pew12 <- pew12 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

# Pew 2011 Political survey
pew11 <- read_sav('pew11.sav')
pew11 <- pew11 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

# Pew 2010 Political Independents survey
pew10 <- read_sav('pew10.sav')
pew10 <- pew10 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

# Pew political typology 2004
pew04 <- read_sav('pew04.sav')
pew04 <- pew04 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

# Pew 1999 political typology
pew99 <- read_sav('pew99.sav')
pew99 <- pew99 %>% 
  mutate(Party = case_when(q42 == 1 | q47 == 1 ~ 'Republican',
                           q42 == 2 | q47 == 2 ~ 'Democrat'))

addSmallLegend <- function(myPlot, pointSize = 0.5, textSize = 8, spaceLegend = 1) {
  myPlot +
    guides(shape = guide_legend(override.aes = list(size = pointSize)),
           color = guide_legend(override.aes = list(size = pointSize))) +
    theme(legend.title = element_text(size = textSize), 
          legend.text  = element_text(size = textSize),
          legend.key.size = unit(spaceLegend, "lines"))
}

```

#### One of the big problems in this country is that we don’t give everyone an equal chance (% agree)
```{r echo=FALSE, message=FALSE, warning=FALSE}
dummy7 <- anes_all %>% 
  filter(VCF9015 <= 5) %>% 
  mutate(agree = ifelse(VCF9015 == 1 | VCF9015 == 2, 1, 0)) 

chance_all <- dummy7 %>% 
  group_by(VCF0004) %>% 
  dplyr::summarize(pct = weighted.mean(agree, w = VCF0009z),
                   max = weighted.mean(agree, w = VCF0009z) + (1.96*(sqrt(wtd.var(agree, weights = VCF0009z))/(sqrt(sum(VCF0009z))))),
                   min = weighted.mean(agree, w = VCF0009z) - (1.96*(sqrt(wtd.var(agree, weights = VCF0009z))/(sqrt(sum(VCF0009z)))))) %>% 
  mutate(Party = 'All')

chance_party <-  dummy7 %>% 
  drop_na(Party) %>% 
  group_by(VCF0004, Party) %>%
  dplyr::summarize(pct = weighted.mean(agree, w = VCF0009z),
                   max = weighted.mean(agree, w = VCF0009z) + (1.96*(sqrt(wtd.var(agree, weights = VCF0009z))/(sqrt(sum(VCF0009z))))),
                   min = weighted.mean(agree, w = VCF0009z) - (1.96*(sqrt(wtd.var(agree, weights = VCF0009z))/(sqrt(sum(VCF0009z))))))

chance <- bind_rows(chance_all, chance_party)
chance <- chance %>% mutate(pct2 = round(pct*100,digits = 0), min2 = round(min*100,digits = 0), max2 = round(max*100, digits = 0))

chance %>%
  ggplot(., aes(x = VCF0004, y = pct2, color = Party)) + 
  geom_line(position = 'dodge') +
  geom_point(position = 'dodge', size = 3) +
  geom_errorbar(width = 0, size = 1, aes(ymin = min2, ymax = max2)) +
  theme_bw() +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10)) +
  labs(x = '', y = 'Percent Agree',
       color = '') +
  scale_color_manual(values = c('black', 'gray50', 'gray80')) +
  theme(plot.title = element_text(size = 12), plot.title.position = 'plot',
        panel.grid = element_blank(), plot.subtitle = element_text(size = 10),
        axis.text.x = element_text(angle = 90, vjust=0.5, hjust=1)) +
  scale_x_continuous(breaks = c(1984, 1986, 1988, 1990, 1992, 1994, 1996, 2000,
                                2004, 2008, 2012))

ggsave('plot2.png', height = 7.5, width = 7.5)

```
#### Most people can make it if they are willing to work hard (vs hard work is no guarantee of success for most people)
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Pew 2019 American trends
p19 <- pew19 %>%
  filter(WORKHARD_W53 == 1 | WORKHARD_W53 == 2) %>%
  mutate(mostcan = ifelse(WORKHARD_W53 == 1, 1, 0))

p19a_all <- p19 %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = WEIGHT_W54),
                   max = weighted.mean(mostcan, w = WEIGHT_W54) + (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT_W54))/(sqrt(sum(WEIGHT_W54))))),
                   min = weighted.mean(mostcan, w = WEIGHT_W54) - (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT_W54))/(sqrt(sum(WEIGHT_W54)))))) %>%
  mutate(Party = 'All')

p19a_party <- p19 %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = WEIGHT_W54),
                   max = weighted.mean(mostcan, w = WEIGHT_W54) + (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT_W54))/(sqrt(sum(WEIGHT_W54))))),
                   min = weighted.mean(mostcan, w = WEIGHT_W54) - (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT_W54))/(sqrt(sum(WEIGHT_W54)))))) 

p19a <- bind_rows(p19a_all, p19a_party)
p19a <- p19a %>% mutate(year = 2019)


# Pew 2017 Political survey
p17a <- pew17 %>% 
  filter(q25k == 1 | q25k == 2) %>% 
  mutate(mostcan = ifelse(q25k == 1, 1, 0))

p17a_all <- p17a %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

p17a_party <- p17a %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) 

p17a <- bind_rows(p17a_all, p17a_party)
p17a <- p17a %>% mutate(year = 2017)

# Pew 2016 Political survey - same as previous???
pew16a <- pew16 %>%
  filter(q50d == 1 | q50d == 2) %>%
  mutate(mostcan = ifelse(q50d == 1, 1, 0))

p16_all <- pew16a %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

p16_party <- pew16a %>%
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))))


p16a <- bind_rows(p16_all, p16_party)
p16a <- p16a %>% mutate(year = 2016)


# Pew 2014 Polarization survey
pew14a <- pew14 %>% 
  filter(q25k == 1 | q25k == 2) %>% 
  mutate(mostcan = ifelse(q25k == 1, 1, 0))

p14_all <- pew14a %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = "All")

p14_party <- pew14a %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) 

p14a <- bind_rows(p14_all, p14_party) 
p14a <- p14a %>% mutate(year = 2014)

# Pew 2012 middle class survey
pew12a <- pew12 %>%
  filter(q11 == 1 | q11 == 2) %>% 
  mutate(mostcan = ifelse(q11 == 1, 1, 0))

p12_all <- pew12a %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All') 

p12_party <- pew12a %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))))

p12a <- bind_rows(p12_all, p12_party)
p12a <- p12a %>% mutate(year = 2012)

# Pew 2011 Political survey
pew11a <- pew11 %>% 
  filter(q44a == 1 | q44a == 2) %>% 
  mutate(mostcan = ifelse(q44a == 1, 1, 0))

p11_all <- pew11a %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

p11_party <- pew11a %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))))

p11a <- bind_rows(p11_all, p11_party)
p11a <- p11a %>% mutate(year = 2011)


# Pew political typology 2004
pew04a <- pew04 %>% 
  filter(q11k != 5 | q11k != 9) %>% 
  mutate(mostcan = ifelse(q11k == 1 | q11k == 2, 1, 0))

p04_all <- pew04a %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All') 

p04_party <- pew04a %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = weight),
                   max = weighted.mean(mostcan, w = weight) + (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(mostcan, w = weight) - (1.96*(sqrt(wtd.var(mostcan, weights = weight))/(sqrt(sum(weight))))))

p04a <- bind_rows(p04_all, p04_party) 
p04a <- p04a %>% mutate(year = 2004)

# Pew 1999 political typology
pew99a <- pew99 %>%
  filter(q18kR == 1 | q18kR == 3) %>% # aggregated...not in codebook
  mutate(mostcan = ifelse(q18kR == 1, 1, 0))

p99_all <- pew99a %>% 
  dplyr::summarize(pct = weighted.mean(mostcan, w = WEIGHT),
                   max = weighted.mean(mostcan, w = WEIGHT) + (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT))/(sqrt(sum(WEIGHT))))),
                   min = weighted.mean(mostcan, w = WEIGHT) - (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT))/(sqrt(sum(WEIGHT)))))) %>%
  mutate(Party = 'All')

p99_party <- pew99a %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(mostcan, w = WEIGHT),
                   max = weighted.mean(mostcan, w = WEIGHT) + (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT))/(sqrt(sum(WEIGHT))))),
                   min = weighted.mean(mostcan, w = WEIGHT) - (1.96*(sqrt(wtd.var(mostcan, weights = WEIGHT))/(sqrt(sum(WEIGHT)))))) 

p99a <- bind_rows(p99_all, p99_party)
p99a <- p99a %>% mutate(year = 1999)

## Together
mostcan <- bind_rows(p19a, p17a, p16a, p14a, p12a, p11a, p04a, p99a)
mostcan <- mostcan %>% mutate(pct2 = round(pct*100, digits = 0), min2 = round(min*100, digits = 0), max2 = round(max*100, digits = 0))

## Plot 
mostcan %>% 
  ggplot(., aes(x = year, y = pct2, color = Party)) + 
  geom_line(position = 'dodge', size = 1) + 
  geom_point(position = 'dodge', size = 3) + 
  geom_errorbar(width = 0, size = 1, aes(ymin = min2, ymax = max2)) +
  theme_bw() +
  labs(x = '', y = 'Percent Agree', color = '') +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10)) +
  theme(plot.title.position = 'plot', plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 10), panel.grid = element_blank(),
        axis.text.x = element_text(angle = 90, vjust=0.5, hjust=1)) + 
  scale_color_manual(values = c('black', 'gray50', 'gray80')) +
  scale_x_continuous(breaks = c(2019, 2017, 2016, 2014, 2012, 2011, 2004, 1999))

ggsave('plot6.png', height = 7.5, width = 7.5)

```

#### which is generally more often to blame if a person is poor (lack of effort vs circumstances beyond control)
```{r echo=FALSE, message=FALSE, warning=FALSE}
# 2018
pq418 <- read_sav('pq4_18.sav')
pq418 <- pq418 %>% 
  mutate(Party = case_when(partysum == 1 ~ 'Republican',
                           partysum == 2 ~ 'Democrat')) %>% 
  filter(q64f1 == 1 | q64f1 == 2) %>% # filterout out "both/idk/neither"
  mutate(noeffort = ifelse(q64f1 == 1, 1, 0))

pq18_all <- pq418 %>% 
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

pq18_party <- pq418 %>%
  drop_na(Party) %>% group_by(Party) %>% 
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))))

pq18 <- bind_rows(pq18_all, pq18_party)
pq18 <- pq18 %>% mutate(year = 2018)

# data not available.....links not working or present

# 2014
pq414 <- read_sav('pq4_14.sav')
pq414 <- pq414 %>% 
  mutate(Party = case_when(partysum == 1 ~ 'Republican',
                           partysum == 2 ~ 'Democrat')) %>% 
  filter(q53 == 1 | q53 == 2) %>% 
  mutate(noeffort = ifelse(q53 == 1, 1, 0))

pq14_all <- pq414 %>%
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight)))))) %>% 
  mutate(Party = 'All')

pq14_party <- pq414 %>% 
  drop_na(Party) %>% group_by(Party) %>% 
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))))
  

pq14 <- bind_rows(pq14_all, pq14_party)
pq14 <- pq14 %>% mutate(year = 2014)

# 2012
pq412 <- read_sav('pq4_12.sav')
pq412 <- pq412 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat')) %>% 
  filter(q46fb == 1 | q46fb == 2) %>% 
  mutate(noeffort = ifelse(q46fb == 1, 1, 0))

pq12_all <- pq412 %>% 
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

pq12_party <- pq412 %>%
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))))

pq12 <- bind_rows(pq12_all, pq12_party)
pq12 <- pq12 %>% mutate(year = 2012)

# 2010
pq410 <- read_sav('pq4_10.sav')
pq410 <- pq410 %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat')) %>% 
  filter(q31 == 1 | q31 == 2) %>%
  mutate(noeffort = ifelse(q31 == 1, 1, 0))

pq10_all <- pq410 %>%
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

pq10_party <- pq410 %>% 
  drop_na(Party) %>% group_by(Party) %>% 
  dplyr::summarize(pct = weighted.mean(noeffort, w = weight),
                   max = weighted.mean(noeffort, w = weight) + (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(noeffort, w = weight) - (1.96*(sqrt(wtd.var(noeffort, weights = weight))/(sqrt(sum(weight))))))

pq10 <- bind_rows(pq10_all, pq10_party)
pq10 <- pq10 %>% mutate(year = 2010)

# 1997 - INCLUDING OVERSAMPLE AFRICAN....NOT WORKING


# together
pq4 <- bind_rows(pq18, pq14, pq12, pq10)
pq4 <- pq4 %>% mutate(pct2 = round(pct*100, digits = 0),
                      min2 = round(min*100, digits = 0),
                      max2 = round(max*100, digits = 0))

pq4 %>% 
  ggplot(., aes(x = year, y = pct2, color = Party)) +
  geom_line(position = 'dodge', size = 1) +
  geom_point(position = 'dodge', size = 3) +
  geom_errorbar(width = 0, size = 1, aes(ymin = min2, ymax = max2)) +
  theme_bw() +
  labs(x = '', y = 'Percent Agree',
       color = '') +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10)) +
  theme(plot.title.position = 'plot', plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 10), panel.grid = element_blank(),
        axis.text.x = element_text(angle = 90, vjust=0.5, hjust=1)) + 
  scale_color_manual(values = c('black', 'gray50', 'gray80')) +
  scale_x_continuous(breaks = c(2010, 2012, 2014, 2018))

ggsave('plot4.png', height = 7.5, width = 7.5)

```
#### Poor people today [have hard lives because government benefits don't go far enough/ have it easy because of benefits]
```{r echo=FALSE, message=FALSE, warning=FALSE}


# Pew 2017 typology
pew17c <- pew17 %>% 
  filter(q25c == 1 | q25c == 2) %>% 
  mutate(easypoor = ifelse(q25c == 1, 1, 0))

pew17_all <- pew17c %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

pew17_party <- pew17c %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) 

p17c <- bind_rows(pew17_all, pew17_party)
p17c <- p17c %>% mutate(year = 2017)


# Pew 2015 governance survey
pew15c <- read_sav('pew15_2.sav')
pew15c <- pew15c %>% 
  mutate(Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat')) %>% 
  filter(q42c == 1 | q42c == 2) %>% 
  mutate(easypoor = ifelse(q42c == 1, 1, 0))

p15c_all <- pew15c %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

p15c_party <- pew15c %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))))

p15c <- bind_rows(p15c_all, p15c_party)
p15c <- p15c %>% mutate(year = 2015)


# 2014 polarization survey
pew14c <- pew14 %>% 
  filter(q25c == 1 | q25c == 2) %>% 
  mutate(easypoor = ifelse(q25c == 1, 1, 0))

p14c_all <- pew14c %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

p14c_party <- pew14c %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))))

p14c <- bind_rows(p14c_all, p14c_party)
p14c <- p14c %>% mutate(year = 2014)


# 2011 political typology
poor11 <- read_sav('poor11.sav')
poor11 <- poor11 %>% 
  filter(q17c < 5) %>% 
  mutate(easypoor = ifelse(q17c == 1 | q17c == 2, 1, 0),
          Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

poor11_all <- poor11 %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All') 

poor11_party <- poor11 %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))))
  
poor11_bind <- bind_rows(poor11_all, poor11_party)
poor11_bind <- poor11_bind %>% mutate(year = 2011)

# 2004 political typology
poor04 <- pew04 %>% 
  filter(q11c < 5) %>% 
  mutate(easypoor = ifelse(q11c == 1 | q11c == 2, 1, 0))

poor04_all <- poor04 %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All') 

poor04_party <- poor04 %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) 

poor04_bind <- bind_rows(poor04_all, poor04_party)
poor04_bind <- poor04_bind %>% mutate(year = 2004)


# 2003 Methology study
poor03 <- read_sav('poor03.sav')
poor03 <- poor03 %>% 
  filter(q6b < 5) %>% 
  mutate(easypoor = ifelse(q6b == 1 | q6b == 2, 1, 0),
         Party = case_when(party == 1 | partyln == 1 ~ 'Republican',
                           party == 2 | partyln == 2 ~ 'Democrat'))

poor03_all <- poor03 %>% 
  drop_na(weight) %>%   # weight has NAs????????????
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight)))))) %>%
  mutate(Party = 'All')

poor03_party <- poor03 %>% 
  drop_na(Party, weight) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = weight, na.rm = T),
                   max = weighted.mean(easypoor, w = weight) + (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))),
                   min = weighted.mean(easypoor, w = weight) - (1.96*(sqrt(wtd.var(easypoor, weights = weight))/(sqrt(sum(weight))))))

poor03_bind <- bind_rows(poor03_all, poor03_party)
poor03_bind <- poor03_bind %>% mutate(year = 2003)

# 1999 Political typology survey
poor99 <- read_sav('poor99.sav')
poor99 <- poor99 %>% 
  filter(q18c == 1 | q18c == 2 | q18c == 3 | q18c ==  4) %>% 
  mutate(easypoor = ifelse(q18c == 1 | q18c == 2, 1, 0),
          Party = case_when(q42 == 1 | q47 == 1 ~ 'Republican',
                           q42 == 2 | q47 == 2 ~ 'Democrat'))

poor99_all <- poor99 %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = WEIGHT),
                   max = weighted.mean(easypoor, w = WEIGHT) + (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT))))),
                   min = weighted.mean(easypoor, w = WEIGHT) - (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT)))))) %>%
  mutate(Party = 'All') 

poor99_party <- poor99 %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = WEIGHT),
                   max = weighted.mean(easypoor, w = WEIGHT) + (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT))))),
                   min = weighted.mean(easypoor, w = WEIGHT) - (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT)))))) 

poor99_bind <- bind_rows(poor99_all, poor99_party)
poor99_bind <- poor99_bind %>% mutate(year = 1999)


# 1997 DIFFERENT OUTCOME
pew97 <- read_sav('pew97.sav')
pew97 <- pew97 %>% 
  filter(Q4B < 5) %>% 
  mutate(easypoor = ifelse(Q4B == 1 | Q4B == 2, 1, 0),
         Party = case_when(D13 == 1 | D14 == 1 ~ 'Republican',
                           D13 == 2 | D14 == 2 ~ 'Democrat'))
p97c_all <- pew97 %>% 
  dplyr::summarize(pct = weighted.mean(easypoor, w = WEIGHT),
                   max = weighted.mean(easypoor, w = WEIGHT) + (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT))))),
                   min = weighted.mean(easypoor, w = WEIGHT) - (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT)))))) %>%
  mutate(Party = 'All')

p97c_party <- pew97 %>% 
  drop_na(Party) %>% group_by(Party) %>%
  dplyr::summarize(pct = weighted.mean(easypoor, w = WEIGHT),
                   max = weighted.mean(easypoor, w = WEIGHT) + (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT))))),
                   min = weighted.mean(easypoor, w = WEIGHT) - (1.96*(sqrt(wtd.var(easypoor, weights = WEIGHT))/(sqrt(sum(WEIGHT)))))) 

p97c <- bind_rows(p97c_all, p97c_party)
p97c <- p97c %>% mutate(year = 1997)

# together
easypoor <- bind_rows(p17c, p15c, p14c, poor11_bind, poor04_bind, poor03_bind, poor99_bind, p97c)
easypoor <- easypoor %>% mutate(pct2 = round(pct*100, digits = 0),
                                min2 = round(min*100, digits = 0),
                                max2 = round(max*100, digits = 0))

# plot

easypoor %>% 
  ggplot(., aes(x = year, y = pct2, color = Party)) + 
  geom_line(position = 'dodge', size = 1) +
  geom_point(position = 'dodge', size = 3) +
  geom_errorbar(width = 0, size = 1, aes(ymin = min2, ymax = max2)) +
  labs(color = '', x = '', y = 'Percent Agree') +
  theme_bw() +
   scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10)) +
  theme(plot.title.position = 'plot', plot.title = element_text(size = 11),
        plot.subtitle = element_text(size = 10), panel.grid = element_blank(),
        axis.text.x = element_text(angle = 90, vjust=0.5, hjust=1)) + 
  scale_color_manual(values = c('black', 'gray50', 'gray80')) +
  scale_x_continuous(breaks = c(1997, 1999, 2003, 2004, 2011, 2014, 2015, 2017))

ggsave('plot7.png', height = 7.5, width = 7.5)

```













